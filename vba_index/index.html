
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.3.9">
    
    
      
        <title>VBA Code Summary - Budget Dance</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#vba-code-summary" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Budget Dance" class="md-header__button md-logo" aria-label="Budget Dance" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Budget Dance
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              VBA Code Summary
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Budget Dance" class="md-nav__button md-logo" aria-label="Budget Dance" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Budget Dance
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Tools to map accounting data to long term plans
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../appendix/" class="md-nav__link">
        Appendix
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../data_from_moneydance/" class="md-nav__link">
        Data from Moneydance
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../fcast/" class="md-nav__link">
        Design and use of fcast.xlsm
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../setup/" class="md-nav__link">
        Setting up the spreadsheet
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        VBA Code Summary
      </a>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../vba_sorted/" class="md-nav__link">
        VBA Code
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="vba-code-summary">VBA Code Summary</h1>
<table>
<thead>
<tr>
<th>Function or Sub</th>
<th>Signature and info</th>
</tr>
</thead>
<tbody>
<tr>
<td>acct_who1</td>
<td>Function acct_who1(acct As String) As String</td>
</tr>
<tr>
<td></td>
<td>Return the first initial of the owner of an account in format type - who - firm</td>
</tr>
<tr>
<td>add_wdraw</td>
<td>Function add_wdraw(acct As String, y_year As String, Optional is_fcst As Boolean = False) As Variant</td>
</tr>
<tr>
<td></td>
<td>Grab the actual transfers in (positive) our out(negative). Ignoring the optional is_fcst argument - instead: compute it</td>
</tr>
<tr>
<td>age_of</td>
<td>Function age_of(inits As String, y_year As String) As Integer</td>
</tr>
<tr>
<td></td>
<td>Return the age attained by an account owner in a given year</td>
</tr>
<tr>
<td>ANN</td>
<td>Function ANN(account As String, account_owner As String, y_year As String) As Double</td>
</tr>
<tr>
<td></td>
<td>Return a year's value for an annuity stream based on the prior year's end balance. Does not properly handle partial years</td>
</tr>
<tr>
<td>calc_retir</td>
<td>Sub calc_retir()</td>
</tr>
<tr>
<td></td>
<td>Iterate through the years to calc retirement streams based on balances from prior year. Prior balance from balances feeds current retirement, which feeds aux, which feeds current balances. Iande depends on retirement as well and taxes depend on iande</td>
</tr>
<tr>
<td>d2s</td>
<td>Function d2s(dt As Date) As String</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td>endbal</td>
<td>Function endbal(acct As String, y_year As String) As Variant</td>
</tr>
<tr>
<td></td>
<td>Compute the end balance for an account for a year</td>
</tr>
<tr>
<td>Fed_Tax_CapGn</td>
<td>Function Fed_Tax_CapGn(tax_Year As Integer, taxable_Income As Double, totCapGn As Double) As Double</td>
</tr>
<tr>
<td></td>
<td>Computes the resulting federal tax with capital gains portion at 15%. The input should include qualified dividends</td>
</tr>
<tr>
<td>Federal_Tax</td>
<td>Function Federal_Tax(tax_Year As Integer, taxable_Income As Double) As Double</td>
</tr>
<tr>
<td></td>
<td>Calculate the federal income tax for a given year and taxable income amount. Gets a result of zero if year not in the table.</td>
</tr>
<tr>
<td>gain</td>
<td>Function gain(acct As String, y_year As String, realized As Boolean) As Variant</td>
</tr>
<tr>
<td></td>
<td>For bank accounts and investments, return the realized or unrealized gain for an account for a year for actual or forecast. Other types of accounts return zero.. For investments actuals, use the values from invest_actl. For bank account actuals use the row in iande defined by the 'bank_interest' value on the general (state) table</td>
</tr>
<tr>
<td>get_val</td>
<td>Function get_val(line_key As Variant, tbl_name As String, col_name As String) As Variant</td>
</tr>
<tr>
<td></td>
<td>Fetches a value from a given table (it must be an actual worksheet table. If the line is not found in the table, a zero is returned.</td>
</tr>
<tr>
<td>IntYear</td>
<td>Function IntYear(yval) As Integer</td>
</tr>
<tr>
<td></td>
<td>Strips off the y on the argument (eg y2019) and returns an integer</td>
</tr>
<tr>
<td>is_forecast</td>
<td>Function is_forecast(y_year As String) As Boolean</td>
</tr>
<tr>
<td></td>
<td>Determine if this year is a forecast year</td>
</tr>
<tr>
<td>log</td>
<td>Sub log(txt As String)</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td>LUMP</td>
<td>Function LUMP(account As String, y_year As String) As Double</td>
</tr>
<tr>
<td></td>
<td>Return the expected lump sum payment for an account based on the prior year's end balance + any items in the aux table. For the current year (items that begin with the account name)</td>
</tr>
<tr>
<td>MedicarePrem</td>
<td>Function MedicarePrem(bord As Integer, year As String, magi As Variant, inflation As Variant) As Variant</td>
</tr>
<tr>
<td></td>
<td>Given a year (as y+year) and the modifed adjusted gross (2 years ago) return annual part b premium or part d surcharge (irmaa). Bord isa 1 for part b premium or 2 for part d surcharge. If the year is not in the table, then the largest year lower than that given will be used. And the resulting value will include inflation.  inflation is given as 1.0x so it can be used directly</td>
</tr>
<tr>
<td>mo_apply</td>
<td>Function mo_apply(start_date As Date, y_year As String, Optional end_mdy As String = "") As Double</td>
</tr>
<tr>
<td></td>
<td>Get a rational number that represents the number of months that apply in a particular year given the start date and optionally an end date. The end date is a string since there is a bug in the mac excel.. The end date represents the month of the last period to include.  the day is ignored and the last day of the month is used.</td>
</tr>
<tr>
<td>PartBPrem</td>
<td>Function PartBPrem(year As String, magi As Variant, inflation As Variant) As Variant</td>
</tr>
<tr>
<td></td>
<td>Given a year (as y+year) and the modifed adjusted gross (2 years ago) return annual part b premium. If the year is not in the table, then the largest year lower than that given will be used. And the resulting value will include inflation.  inflation is given as 1.0x so it can be used directly</td>
</tr>
<tr>
<td>PartDSurcharge</td>
<td>Function PartDSurcharge(year As String, magi As Variant, inflation As Variant) As Variant</td>
</tr>
<tr>
<td></td>
<td>Given a year (as y+year) and the modifed adjusted gross (2 years ago) return annual part d surcharge. If the year is not in the table, then the largest year lower than that given will be used. And the resulting value will include inflation.  inflation is given as 1.0x so it can be used directly</td>
</tr>
<tr>
<td>retir_med</td>
<td>Function retir_med(who1 As String, y_year As String) As Double</td>
</tr>
<tr>
<td></td>
<td>Return the forecast medical expenses including premium and deductible for person with initial who1 given a year</td>
</tr>
<tr>
<td>retir_parm</td>
<td>Function retir_parm(code As String, who As String) As Variant</td>
</tr>
<tr>
<td></td>
<td>Get a retirement paramenter given code and code (g or v)</td>
</tr>
<tr>
<td>RMD_1</td>
<td>Function RMD_1(account As String, account_owner As String, y_year As String, Optional death_year As Integer = 0) As Double</td>
</tr>
<tr>
<td></td>
<td>Return the req minimum distribution table 1 result for a year for a given account, owner (gbd or vec) and year.. If death year is not given then this function treat this as spousal inheritance. If death year is given the treat this as a beneficiary inheritance</td>
</tr>
<tr>
<td>rolling_avg</td>
<td>Function rolling_avg(table As String, key As String, this_y_year As String, lookback As Integer) As Double</td>
</tr>
<tr>
<td></td>
<td>Look back at previous columns and average the numeric values found there, ignoring non-numerics. Return the average</td>
</tr>
<tr>
<td>simple_return</td>
<td>Function simple_return(account As String, y_year As String) As Double</td>
</tr>
<tr>
<td></td>
<td>Return the rlzd gain divided by the average of the start and end balances (or zero)</td>
</tr>
<tr>
<td>sort_tax_table</td>
<td>Function sort_tax_table()</td>
</tr>
<tr>
<td></td>
<td>Make sure the federal tax tables are sorted properly</td>
</tr>
<tr>
<td>test_fed_tax</td>
<td>Sub test_fed_tax()</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td>test_get_val</td>
<td>Sub test_get_val()</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td>test_LUMP</td>
<td>Sub test_LUMP()</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td>test_medicarePrem</td>
<td>Sub test_medicarePrem()</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td>test_mo_apply</td>
<td>Sub test_mo_apply()</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td>test_retir_med</td>
<td>Sub test_retir_med()</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td>test_sort</td>
<td>Sub test_sort()</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td>unrlz</td>
<td>Function unrlz(acct As String, y_year As String) As Variant</td>
</tr>
<tr>
<td></td>
<td>Compute the unrealized gain or loss for an account for a year, assuming end bal is fixed</td>
</tr>
<tr>
<td>ws_for_table_name</td>
<td>Function ws_for_table_name(tbl_name As String) As String</td>
</tr>
<tr>
<td></td>
<td>Find out what worksheet the named table occurs on</td>
</tr>
</tbody>
</table>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../setup/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Setting up the spreadsheet" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Setting up the spreadsheet
            </div>
          </div>
        </a>
      
      
        
        <a href="../vba_sorted/" class="md-footer__link md-footer__link--next" aria-label="Next: VBA Code" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              VBA Code
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.6c7ad80a.min.js"></script>
      
    
  </body>
</html>