# Defined Excel Lambda functions

| name          | comment                                                                                                                                          | formula                                                                                                                               |
|:--------------|:-------------------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------|
| AGE           | Return the age attained by an account owner with inits in a given year                                                                           | =LAMBDA(inits,yr,ROUNDDOWN(((DATE(yr,12,31)-DOB(inits))/365.25),0))                                                                   |
| AGI_2         | Returns the adjusted gross income from two years ago.  To be used in a table in a year col. No arguments.                                        | =LAMBDA(XLOOKUP("Adjusted gross - TOTAL",tbl_taxes[Key],CHOOSECOLS(tbl_taxes[#Data],-2+XMATCH(this_col_name(),tbl_taxes[#Headers])))) |
| DAY_COUNT     | The number of days from the first date to the last date, inclusive. Call with 2 element array.                                                   | =LAMBDA(arr,MAX(0,1+SUM({-1,1}*arr)))                                                                                                 |
| DEFAULT_DATE  | Given a value that is a date or blank, return the blank to the horizon, the given date (if not blank)                                            | =LAMBDA(d,IF(ISBLANK(d),HORIZON(),d))                                                                                                 |
| DOB           | Get date of birth for initials                                                                                                                   | =LAMBDA(inits,XLOOKUP(inits,tbl_people[Initials],tbl_people[DOB]))                                                                    |
| FIRST_LAST    | Return the first and last date in a year, given an integer year.                                                                                 | =LAMBDA(y,HSTACK(DATE(y,1,1),DATE(y,12,31)))                                                                                          |
| HORIZON       | Returns the last date in the planning horizon                                                                                                    | =LAMBDA(DATE(0+RIGHT(TAKE(tbl_balances[#Headers],1,-1),4),12,31))                                                                     |
| MAX_MIN       | Return the max of the 1st column and the min of the 2nd column                                                                                   | =LAMBDA(arr,HSTACK(MAX(CHOOSECOLS(arr,1)),MIN(CHOOSECOLS(arr,2))))                                                                    |
| MC_RATES      | Returns the best annual medicare rate table as an array. To be run in a table year column. Called with the tbl_part_b[#Data] as the argument.    | =LAMBDA(all_rates,FILTER(all_rates,CHOOSECOLS(all_rates,1)=YEAR_FOR_TBL(all_rates)))                                                  |
| MONTHLY_PARTB | Returns the monthly part B premium for this year. To be run in a table year column. Called with the tbl_part_b[#Data] as the argument.           | =LAMBDA(arr,LET(rates,MC_RATES(arr),m,CHOOSECOLS(rates,3),b,CHOOSECOLS(rates,4),XLOOKUP(AGI_2(),m,b,0,1)))                            |
| MONTHLY_PARTD | Returns the monthly part D premium surcharge for this year. To be run in a table year column. Called with the tbl_part_b[#Data] as the argument. | =LAMBDA(arr,LET(rates,MC_RATES(arr),m,CHOOSECOLS(rates,3),b,CHOOSECOLS(rates,5),XLOOKUP(AGI_2(),m,b,0,1)))                            |
| PORTION       | The number of days in this year where this row applies divided by 365.                                                                           | =LAMBDA(s,e,y,DAY_COUNT(MAX_MIN(VSTACK(HSTACK(s,DEFAULT_DATE(e)),FIRST_LAST(y))))/365)                                                |
| THIS_YEAR     | Suitable to use in tables in columns that represent years. Returns the year as a number.                                                         | =LAMBDA(0+RIGHT(this_col_name(),4))                                                                                                   |
| YEAR_FOR_TBL  | return current year or highest year in given table. For use in year columns. Call like this - YEAR_FOR_TBL(tbl_part_b)                           | =LAMBDA(arr,MIN(THIS_YEAR(),MAX(CHOOSECOLS(arr,1))))                                                                                  |