
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../functions/excel_lambdas/">
      
      
        <link rel="next" href="../anti_patterns/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.2">
    
    
      
        <title>Idioms - Budget Dance</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.d451bc0e.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.a5377069.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#some-excel-idioms-notes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Budget Dance" class="md-header__button md-logo" aria-label="Budget Dance" data-md-component="logo">
      
  <img src="../assets/images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Budget Dance
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Idioms
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Budget Dance" class="md-nav__button md-logo" aria-label="Budget Dance" data-md-component="logo">
      
  <img src="../assets/images/logo.png" alt="logo">

    </a>
    Budget Dance
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Workbook
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Workbook
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../workbook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Design of the workbook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Worksheets
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Worksheets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../worksheets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index of worksheets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2_2" id="__nav_2_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Accounts & Balances
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            Accounts & Balances
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../sheets/accounts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Accounts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../sheets/balances/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Balances
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../sheets/transfers_plan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transfers plan
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_2_3" id="__nav_2_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Income, Expense & Cashflow
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_3">
            <span class="md-nav__icon md-icon"></span>
            Income, Expense & Cashflow
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../sheets/iande/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    All years
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../sheets/current/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Current year
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../sheets/aux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Auxilliary calculations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../sheets/invest_iande_work/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Impact of investments
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_2_4" id="__nav_2_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Retirement
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_4">
            <span class="md-nav__icon md-icon"></span>
            Retirement
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../sheets/retirement/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Income & medical plan
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../sheets/retireparms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Retirement parameters
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_2_5" id="__nav_2_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Various Actuals
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_5">
            <span class="md-nav__icon md-icon"></span>
            Various Actuals
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../sheets/invest_actl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Investments Actuals
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../sheets/transfers_actl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transfers Actuals
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../sheets/other_actl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Other Actuals
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_2_6" id="__nav_2_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    taxes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2_6">
            <span class="md-nav__icon md-icon"></span>
            taxes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../sheets/tax_tables/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tax tables
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../sheets/cap_gain/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Capital gains
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../sheets/taxes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Taxes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../sheets/gen_tables/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    General
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../sheets/utility/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Utility
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" checked>
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Formulas
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Formulas
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../functions/excel_lambdas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Helpers (Lambdas)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Idioms
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Idioms
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#this-column" class="md-nav__link">
    This column
  </a>
  
    <nav class="md-nav" aria-label="This column">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#getting-the-column-name" class="md-nav__link">
    Getting the column name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-of-the-structured-data-notation" class="md-nav__link">
    Use of the structured [#Data] notation
  </a>
  
    <nav class="md-nav" aria-label="Use of the structured [#Data] notation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#getting-data-column-with-index-or-choosecols" class="md-nav__link">
    Getting data column with Index or Choosecols
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-last-column-name-and-data" class="md-nav__link">
    The last column name and data
  </a>
  
    <nav class="md-nav" aria-label="The last column name and data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-last-data-column" class="md-nav__link">
    The last data column
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-last-column-field-name" class="md-nav__link">
    The last column field name
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lookup" class="md-nav__link">
    Lookup
  </a>
  
    <nav class="md-nav" aria-label="Lookup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#constructing-a-key" class="md-nav__link">
    Constructing a key
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delimited-strings-to-arrays" class="md-nav__link">
    Delimited strings to arrays
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#substring-match" class="md-nav__link">
    Substring match
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#is-value-in-a-list" class="md-nav__link">
    Is value in a list
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#filter-then-aggregate" class="md-nav__link">
    Filter then aggregate
  </a>
  
    <nav class="md-nav" aria-label="Filter then aggregate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#if-filter-can-be-empty" class="md-nav__link">
    If filter can be empty
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#convert-transaction-format-to-net-change" class="md-nav__link">
    Convert transaction format to net change
  </a>
  
    <nav class="md-nav" aria-label="Convert transaction format to net change">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#construct-debitcredit-array-for-account" class="md-nav__link">
    Construct debit/credit array for account
  </a>
  
    <nav class="md-nav" aria-label="Construct debit/credit array for account">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#make-boolean-array" class="md-nav__link">
    Make boolean array
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#construct-two-values-array-column-array" class="md-nav__link">
    Construct two values array column array
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiply-them" class="md-nav__link">
    Multiply them
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-across-rows" class="md-nav__link">
    Add across rows
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#final-sum" class="md-nav__link">
    Final sum
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#forecasting-based-on-last-n-elements" class="md-nav__link">
    Forecasting based on last n elements
  </a>
  
    <nav class="md-nav" aria-label="Forecasting based on last n elements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-prior-cells-on-this-row" class="md-nav__link">
    Get Prior cells on this row
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#let-example-simple-return-calculation" class="md-nav__link">
    LET example: Simple return calculation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tax-calculations" class="md-nav__link">
    Tax calculations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conditional-formatting-limits" class="md-nav__link">
    Conditional Formatting limits
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#looking-for-non-native-formulas" class="md-nav__link">
    Looking for non-native formulas
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../anti_patterns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Anti-patterns
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Data
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../data_files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data files
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../report_configs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Report definitions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../accounting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Accounting notes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../validation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Validation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Setup
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Setup
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../setup_summary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Summary
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../libraries/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Libraries
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../setup_api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API Key
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../setup_control/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup control file
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../python/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python environment
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Operations
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Operations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../operations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Export/Import Cycle
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../use_cases/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Use cases
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#this-column" class="md-nav__link">
    This column
  </a>
  
    <nav class="md-nav" aria-label="This column">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#getting-the-column-name" class="md-nav__link">
    Getting the column name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-of-the-structured-data-notation" class="md-nav__link">
    Use of the structured [#Data] notation
  </a>
  
    <nav class="md-nav" aria-label="Use of the structured [#Data] notation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#getting-data-column-with-index-or-choosecols" class="md-nav__link">
    Getting data column with Index or Choosecols
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-last-column-name-and-data" class="md-nav__link">
    The last column name and data
  </a>
  
    <nav class="md-nav" aria-label="The last column name and data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-last-data-column" class="md-nav__link">
    The last data column
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-last-column-field-name" class="md-nav__link">
    The last column field name
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lookup" class="md-nav__link">
    Lookup
  </a>
  
    <nav class="md-nav" aria-label="Lookup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#constructing-a-key" class="md-nav__link">
    Constructing a key
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delimited-strings-to-arrays" class="md-nav__link">
    Delimited strings to arrays
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#substring-match" class="md-nav__link">
    Substring match
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#is-value-in-a-list" class="md-nav__link">
    Is value in a list
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#filter-then-aggregate" class="md-nav__link">
    Filter then aggregate
  </a>
  
    <nav class="md-nav" aria-label="Filter then aggregate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#if-filter-can-be-empty" class="md-nav__link">
    If filter can be empty
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#convert-transaction-format-to-net-change" class="md-nav__link">
    Convert transaction format to net change
  </a>
  
    <nav class="md-nav" aria-label="Convert transaction format to net change">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#construct-debitcredit-array-for-account" class="md-nav__link">
    Construct debit/credit array for account
  </a>
  
    <nav class="md-nav" aria-label="Construct debit/credit array for account">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#make-boolean-array" class="md-nav__link">
    Make boolean array
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#construct-two-values-array-column-array" class="md-nav__link">
    Construct two values array column array
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiply-them" class="md-nav__link">
    Multiply them
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-across-rows" class="md-nav__link">
    Add across rows
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#final-sum" class="md-nav__link">
    Final sum
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#forecasting-based-on-last-n-elements" class="md-nav__link">
    Forecasting based on last n elements
  </a>
  
    <nav class="md-nav" aria-label="Forecasting based on last n elements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-prior-cells-on-this-row" class="md-nav__link">
    Get Prior cells on this row
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#let-example-simple-return-calculation" class="md-nav__link">
    LET example: Simple return calculation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tax-calculations" class="md-nav__link">
    Tax calculations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conditional-formatting-limits" class="md-nav__link">
    Conditional Formatting limits
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#looking-for-non-native-formulas" class="md-nav__link">
    Looking for non-native formulas
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="some-excel-idioms-notes">Some Excel idioms &amp; notes</h1>
<h2 id="this-column">This column</h2>
<h3 id="getting-the-column-name">Getting the column name</h3>
<p>The lambda function THIS_COL_HDR is used internal to a table to identify the column name.  Call with tbl_xxx[#Headers]</p>
<p>Alternatively, native way to locate this column name is (this only works when the table starts in Excel column 1)</p>
<div class="highlight"><pre><span></span><code><span id="__codeline-0-1">=INDEX(tbl_balances[#Headers],COLUMN())
</span></code></pre></div>
<p>Note, that the table name can be elided to reference the table the cell is in.  Excel displays the just table name in the formula even if it is not provided. But its best to provide the full expression the <code>setup.yaml</code>.</p>
<div class="highlight"><pre><span></span><code><span id="__codeline-1-1">INDEX([#Headers],COLUMN())
</span></code></pre></div>
<p>To locate the column of a different table, the offset can be determined with <code>XMATCH</code>:</p>
<div class="highlight"><pre><span></span><code><span id="__codeline-2-1">XMATCH(THIS_COL_HDR[#tbl_balances[#Headers]],tbl_retir_vals[#Headers])
</span></code></pre></div>
<h3 id="use-of-the-structured-data-notation">Use of the structured [#Data] notation</h3>
<p>Using this formulation creates a dependency on the whole table, which is fine for looking up values that themselves don't depend on other tables. But it is not appropriate for year-to-year calculations, as it will create circular logic.</p>
<h4 id="getting-data-column-with-index-or-choosecols">Getting data column with Index or Choosecols</h4>
<p>These phrases require the [#Data] phrase when entered via openpyxl, even though it disappears in Excel when edited. Otherwise you get a name error.</p>
<p><code>=INDEX(tbl_aux[#Data],0,COLUMN())</code></p>
<p><code>=CHOOSECOLS(tbl_balances[#Data],COLUMN())</code></p>
<p>The following picks a year column from balances by locating the year in the headers and using that to choose the column.</p>
<p><code>=CHOOSECOLS(tbl_balances[#Data],XMATCH(this_col_name(),tbl_balances[#Headers]))</code></p>
<div class="highlight"><span class="filename">Prior year end balance</span><pre><span></span><code><span id="__codeline-3-1">=XLOOKUP(&quot;End Bal&quot;&amp;tbl_retir_vals[@Item],tbl_balances[Key],
</span><span id="__codeline-3-2">  CHOOSECOLS(tbl_balances[#Data],XMATCH(this_col_name(),tbl_balances[#Headers])-1)
</span><span id="__codeline-3-3">  )
</span></code></pre></div>
<h2 id="the-last-column-name-and-data">The last column name and data</h2>
<h3 id="the-last-data-column">The last data column</h3>
<p>Takes the last data column. Useful for actual only tables that you want to propagate the last values from.</p>
<div class="highlight"><pre><span></span><code><span id="__codeline-4-1">CHOOSECOLS(tbl_manual_actl[#Data],-1)
</span></code></pre></div>
<h3 id="the-last-column-field-name">The last column field name</h3>
<p>Useful to get the last actual, for instance.</p>
<div class="highlight"><pre><span></span><code><span id="__codeline-5-1">=TAKE(tbl_manual_actl[#Headers],1,-1)
</span></code></pre></div>
<h2 id="lookup">Lookup</h2>
<p>Use a value from this table to find a value in another table. The 4th parameter is the default if not found.
=XLOOKUP("Medicare withholding rate",tbl_manual_actl[Item],CHOOSECOLS(tbl_manual_actl[#Data],-1))</p>
<p><div class="highlight"><span class="filename">Locate a value with a common key</span><pre><span></span><code><span id="__codeline-6-1">=XLOOKUP(&quot;Medicare withholding rate&quot;,tbl_manual_actl[Item],CHOOSECOLS(tbl_manual_actl[#Data],-1))
</span></code></pre></div>
Here get the value for forecast rate using the lastest actual rate.</p>
<h3 id="constructing-a-key">Constructing a key</h3>
<p>Often the exact key has to be constructed.  Excel uses double quotes for strings and <code>&amp;</code> for concatenation.  TRIM is needed if the field is, say, indented.</p>
<div class="highlight"><span class="filename">Use string functions to construct key</span><pre><span></span><code><span id="__codeline-7-1">&quot;Add/Wdraw&quot;&amp;TRIM([@Account])
</span></code></pre></div>
<h2 id="delimited-strings-to-arrays">Delimited strings to arrays</h2>
<p>Often the field value may have delimiters and you need to pick out one of the sections.  Use the TEXTSPLIT and INDEX functions. For instance to pick out the 2nd item of the field <code>key</code>. Note the delimiter can be longer than a single character.</p>
<div class="highlight"><span class="filename">Picking values between delimiters</span><pre><span></span><code><span id="__codeline-8-1">INDEX(TEXTSPLIT([@key],&quot; - &quot;),2)
</span></code></pre></div>
<h2 id="substring-match">Substring match</h2>
<p>Is a substring in a list?  Use SEARCH wrapped with ISNUMBER.</p>
<div class="highlight"><span class="filename">Find values with substring</span><pre><span></span><code><span id="__codeline-9-1">ISNUMBER(SEARCH(&quot;Start BalHSA - &quot;&amp;INDEX(TEXTSPLIT([@key],&quot; - &quot;),2),tbl_balances[Key]))
</span></code></pre></div>
<h2 id="is-value-in-a-list">Is value in a list</h2>
<p>For use in filters, determine if a value is in a list. Construct the list with curly brackets.  Use the type 0 for exact match.</p>
<div class="highlight"><span class="filename">Find values that match a list</span><pre><span></span><code><span id="__codeline-10-1">ISNUMBER(MATCH(tbl_balances[ValType],{&quot;Start Bal&quot;,&quot;Add/Wdraw&quot;,&quot;Reinv Amt&quot;,&quot;Fees&quot;,&quot;Unrlz Gn/Ls&quot;},0)
</span></code></pre></div>
<h2 id="filter-then-aggregate">Filter then aggregate</h2>
<p>Filters produce more than one row so the results have to be aggregated by SUM, PRODUCT, MIN or the like.</p>
<p>Criteria that are all required are multiplied together with *. To allow either criterion, use +.</p>
<p>In this example several rows are selected to compute the end balance. THE Y1234 is replaced at build time for each year column.</p>
<div class="highlight"><span class="filename">Filter with criteria 'anded'</span><pre><span></span><code><span id="__codeline-11-1">=SUM(FILTER(tbl_invest_actl[Y1234],(tbl_invest_actl[ValType]=&quot;Gains&quot;)*(tbl_invest_actl[Acct_txbl]=1)))
</span></code></pre></div>
<h3 id="if-filter-can-be-empty">If filter can be empty</h3>
<p>If the result can be empty then use the if_empty parameter</p>
<div class="highlight"><span class="filename">Last parm of FILTER is 0 to allow empty set</span><pre><span></span><code><span id="__codeline-12-1">=ROUND(SUM(FILTER(tbl_invest_iande_values[Y1234],(tbl_invest_iande_values[Account]=[@AcctName])*(tbl_invest_iande_values[IorE]=&quot;I&quot;),0)),0)
</span></code></pre></div>
<h2 id="convert-transaction-format-to-net-change">Convert transaction format to net change</h2>
<p>The <code>transfers_plan</code> table is in a transactional format, with a year, two accounts (from and to) and a value.  This ensures that both sides of the transaction are accounted for.  However, most other tables have a net change style - what happens to a particular account in a year. This formula converts the plan to the net change format.</p>
<p>Working in memory, two arrays element by element, then add them up.</p>
<h3 id="construct-debitcredit-array-for-account">Construct debit/credit array for account</h3>
<h4 id="make-boolean-array">Make boolean array</h4>
<p>This creates an array of two columns and as many rows as in the table.</p>
<div class="highlight"><span class="filename">Structured table reference to mark this account</span><pre><span></span><code><span id="__codeline-13-1">(tbl_transfers_plan[[From_Account]:[To_Account]]=tbl_balances[@AcctName])
</span></code></pre></div>
<h4 id="construct-two-values-array-column-array">Construct two values array column array</h4>
<p>This creates two columns with the same number of rows with a negative and positive version of each amount</p>
<div class="highlight"><span class="filename">Horizontal stacking</span><pre><span></span><code><span id="__codeline-14-1">HSTACK(-tbl_transfers_plan[Amount],tbl_transfers_plan[Amount])
</span></code></pre></div>
<h4 id="multiply-them">Multiply them</h4>
<table>
<thead>
<tr>
<th></th>
<th style="text-align: center;"></th>
<th></th>
<th style="text-align: center;"></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><img alt="boolean" src="../assets/images/trans_to_net_1.png" /></td>
<td style="text-align: center;">X</td>
<td><img alt="values" src="../assets/images/trans_to_net_2.png" /></td>
<td style="text-align: center;">=</td>
<td><img alt="result" src="../assets/images/trans_to_net_3.png" /></td>
</tr>
</tbody>
</table>
<h3 id="add-across-rows">Add across rows</h3>
<p>The BYROW and LAMBDA functions are used. Each row is passed into lambda as the parameter <code>row</code>, which is then summed.</p>
<div class="highlight"><span class="filename">Sum by row</span><pre><span></span><code><span id="__codeline-15-1">=BYROW((tbl_transfers_plan[[From_Account]:[To_Account]]=tbl_balances[@AcctName])*HSTACK(-tbl_transfers_plan[Amount],tbl_transfers_plan[Amount]),LAMBDA(row,SUM(row)))*(tbl_transfers_plan[Y_Year]=INDEX([#Headers],COLUMN()))
</span></code></pre></div>
<p>The result is then multiplied by the year selection to get all net of all the transactions for the account and year, as shown here:</p>
<p><img alt="result" src="../assets/images/trans_to_net_4.png" /></p>
<h3 id="final-sum">Final sum</h3>
<p>Wrap the whole thing in a <code>SUM()</code> to get the net change in the account for the year.</p>
<div class="highlight"><span class="filename">Full</span><pre><span></span><code><span id="__codeline-16-1">SUM(BYROW((tbl_transfers_plan[[From_Account]:[To_Account]]=tbl_balances[@AcctName])*HSTACK(-tbl_transfers_plan[Amount],tbl_transfers_plan[Amount]),LAMBDA(_xlpm.row,SUM(_xlpm.row)))*(tbl_transfers_plan[Y_Year]=this_col_name()))
</span></code></pre></div>
<h2 id="forecasting-based-on-last-n-elements">Forecasting based on last n elements</h2>
<p>Linear least squares fit. The example looks back 5 columns on this row for the <code>y</code> values and uses numbers 1 to 5 as the <code>x</code> values.  Then we just ask the linear forecast tool to provide item 6.  Wrap the whole thing with a MAX to prevent it from going negative.</p>
<div class="highlight"><span class="filename">Forecast</span><pre><span></span><code><span id="__codeline-17-1">=MAX(0,FORECAST.LINEAR(6,tbl_iande[@5&lt;Y1234],SEQUENCE(1,5)))
</span></code></pre></div>
<h3 id="get-prior-cells-on-this-row">Get Prior cells on this row</h3>
<p>The above uses <a href="../workbook/#build-time-column-substitutions">build time replacement</a>. </p>
<p><code>tbl[@5&lt;Y1234]</code> becomes <code>tbl[[#This Row],[Y2018]:[Y2022]]</code>, when in the Y2023 column.</p>
<p>So the form <code>[@m&lt;Ynnnn]</code> says for the m years in this row preceding this year.</p>
<h2 id="let-example-simple-return-calculation">LET example: Simple return calculation</h2>
<p>The following computes a simplistic return by setting intermediate variables with LET. </p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>y</td>
<td>The column of data for this year</td>
</tr>
<tr>
<td>a</td>
<td>The account name</td>
</tr>
<tr>
<td>b</td>
<td>The value types of the rows to be averaged for the denominator</td>
</tr>
<tr>
<td>c</td>
<td>The value types of the rows to be summed for the numerator</td>
</tr>
<tr>
<td>x</td>
<td>The indicies to locate the denominator values</td>
</tr>
<tr>
<td>w</td>
<td>The indicies to locate the numerator values</td>
</tr>
</tbody>
</table>
<p>after all these are set is fairly easy to use CHOOSEROWS to select the right data elements.  The 2 is for the average. Wrapping with IFERROR forces the #DIV  to 0.</p>
<div class="highlight"><pre><span></span><code><span id="__codeline-18-1">  =LET(
</span><span id="__codeline-18-2">    y,INDIRECT(&quot;tbl_balances[&quot;&amp;@INDEX(tbl_balances[#Headers],COLUMN())&amp;&quot;]&quot;),
</span><span id="__codeline-18-3">    a,[@AcctName],
</span><span id="__codeline-18-4">    b,{&quot;Start Bal&quot;,&quot;End Bal&quot;},
</span><span id="__codeline-18-5">    c,{&quot;Rlz Int/Gn&quot;,&quot;Unrlz Gn/Ls&quot;},
</span><span id="__codeline-18-6">    x,MATCH(@b&amp;a,[Key],0),
</span><span id="__codeline-18-7">    w,MATCH(@c&amp;a,[Key],0),
</span><span id="__codeline-18-8">    IFERROR(2*SUM(CHOOSEROWS(y,w))/SUM(CHOOSEROWS(y,x)),0)
</span><span id="__codeline-18-9">    )
</span></code></pre></div>
<h2 id="tax-calculations">Tax calculations</h2>
<p>There is a set of lambda functions that work together to assist in tax calculations. These culuminate in TX_CT and TX_FED which are inserted on the proper lines due to folding. The file <code>taxes_template.tsv</code> contains lines that call for this type of aggregation:</p>
<ul>
<li>Initial Tax Calculation - CT_TAX</li>
<li>Fed tax - FED_TAX</li>
</ul>
<p>Other states could be patterned off the TX_CT method.</p>
<h2 id="conditional-formatting-limits">Conditional Formatting limits</h2>
<p>Conditional formatting formulas cannot use structured references, including bare table names.</p>
<h2 id="looking-for-non-native-formulas">Looking for non-native formulas</h2>
<div class="highlight"><pre><span></span><code><span id="__codeline-19-1"><span class="w"> </span>grep<span class="w"> </span>formula:<span class="w"> </span>data/setup.yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s1">&#39;XLOOKUP\|LET\|FILTER\|FORECAST\|OFFSET\|BYROW\|INDIRECT&#39;</span>
</span></code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.a264c092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.726fbb30.min.js"></script>
      
    
  </body>
</html>